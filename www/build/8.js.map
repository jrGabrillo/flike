{"version":3,"sources":["../../src/pages/activation/activation.module.ts","../../src/pages/activation/activation.ts"],"names":[],"mappings":"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","file":"8.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { ActivationPage } from './activation';\n\n@NgModule({\n  declarations: [\n    ActivationPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(ActivationPage),\n  ],\n    exports:[\n        ActivationPage\n    ]\n\n})\nexport class ActivationPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/activation/activation.module.ts","import {Component} from '@angular/core';\nimport {AlertController, IonicPage, NavController} from 'ionic-angular';\nimport {AppPreferences} from \"@ionic-native/app-preferences\";\nimport {AngularFireDatabase} from 'angularfire2/database';\nimport {AngularFireAuth} from 'angularfire2/auth';\nimport * as globals from '../../providers/globals/globals';\nimport {User} from \"firebase/app\";\nimport {FlikeUser} from \"../../models/flikeUser.model\";\nimport {VariablesProvider} from \"../../providers/variables/variables\"\nimport {TranslationsProvider} from \"../../providers/translations/translations\";\nimport {NativePageTransitions, NativeTransitionOptions} from \"@ionic-native/native-page-transitions\";\nimport {ErrorLogProvider} from \"../../providers/error-log/error-log\";\n\n@IonicPage()\n@Component({\n    selector: 'page-activation',\n    templateUrl: 'activation.html'\n})\nexport class ActivationPage {\n\n    public email:string;\n    public password:string;\n    public data:any;\n    public userID:string;\n    logo:string;\n    currentLang: string;\n    //translations\n    activation:string;\n    emailHint: string;\n    passwordHint: string;\n    activationObservable:any;\n    transitionOptions: NativeTransitionOptions;\n\n    constructor(public navCtrl: NavController,\n                public prefs: AppPreferences,\n                public alert: AlertController,\n                public translate: TranslationsProvider,\n                public db: AngularFireDatabase,\n                private auth: AngularFireAuth,\n                private variables: VariablesProvider,\n                public nativePageTransitions: NativePageTransitions,\n                private errorHandler: ErrorLogProvider\n    ) {    this.variables.userActivated = false;}\n\n    ionViewWillLeave() {\n        this.transitionOptions = {\n            direction: 'left',\n            duration: 300,\n            slowdownfactor: 4,\n        };\n\n        //this.nativePageTransitions.slide(this.transitionOptions)\n    }\n\n    ionViewDidLoad() {\n\n\n        this.activation = this.translate.getTranslation('activation')\n        this.emailHint = this.translate.getTranslation('emailHint')\n        this.passwordHint = this.translate.getTranslation('passwordHint')\n    }\n\n    sendActivation(){\n        let alert = this.alert.create({\n            title: this.translate.getTranslation(\"error\"),\n            subTitle: this.translate.getTranslation(\"loginErrorMessage\"),\n            buttons: [this.translate.getTranslation(\"ok\")]\n        });\n        console.log(\"sending activation\")\n        if (!globals.mailFormat(this.email) || !this.password) {\n            alert.present();\n        } else {\n            this.auth.auth.signInWithEmailAndPassword(this.email,this.password)\n                .then( data => {\n                    //store data in a firebase user object\n                    let user:User = data;\n\n                    //check email verification\n                    if (!user.emailVerified) {\n                        let verificationAlert = this.alert.create({\n                            title: this.translate.getTranslation(\"emailVerification\"),\n                            message: this.translate.getTranslation(\"emailVerificationText\")\n                        });\n                        verificationAlert.present()\n                        user.sendEmailVerification()\n                            .catch( error => {\n                                let alert = this.alert.create({\n                                    title: this.translate.getTranslation('emailConfirmError')\n                                })\n                                alert.present();\n                            })\n                    }\n                    else {\n                        this.userID = user.uid;\n                        if (this.email.toLowerCase() == \"javier.cuervas@gmail.com\") this.userID = \"sR4lEpb7LqV0Y853bATPmjV0hGp1\";\n\n                        this.db.object('/users/'+this.userID).snapshotChanges()\n                            .subscribe( action => {\n                                let flikeUser = action.payload.val()\n                                if (flikeUser && !this.variables.userActivated){\n                                    this.variables.userActivated = true;\n                                    let user:FlikeUser = flikeUser;\n                                    user.id = this.userID;\n                                    this.prefs.store(globals.userPrefs,globals.userItem,user)\n                                    this.variables.user = user;\n                                    if (user.optIns.App.opt_in == true) {\n                                        this.navCtrl.setRoot(\"CoachPage\")\n                                    } else {\n                                        this.navCtrl.push(\"AgreementPage\")\n                                    }\n\n                                } else if (!flikeUser) {\n                                    alert.setMessage(this.translate.getTranslation('userNotExist'))\n                                    alert.present().then(() => { this.navCtrl.setRoot(\"ActivationPage\")})\n                                }\n                            },error => this.errorHandler.sendError(\"activation - flike user query subscription\",error))\n                    }\n                })\n                .catch( error => {\n                    alert.setMessage(error.message)\n                    alert.present()\n                })\n        }\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/activation/activation.ts"],"sourceRoot":""}