{"version":3,"sources":["../../src/pages/group2/group2.module.ts","../../src/pages/group2/group2.ts"],"names":[],"mappings":"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","file":"3.js","sourcesContent":["import {NgModule} from '@angular/core';\nimport {IonicPageModule} from 'ionic-angular';\nimport {Group2Page} from './group2';\n\n@NgModule({\n  declarations: [\n    Group2Page,\n  ],\n  imports: [\n    IonicPageModule.forChild(Group2Page),\n  ],\n    exports:[\n        Group2Page\n    ]\n})\nexport class Group2PageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/group2/group2.module.ts","import {Component} from '@angular/core';\nimport {App, IonicPage, LoadingController, NavController, NavParams} from 'ionic-angular';\nimport {AppPreferences} from \"@ionic-native/app-preferences\";\nimport {ChatRoom} from \"../../models/chatroom.model\";\nimport {AngularFireDatabase} from \"angularfire2/database\";\nimport * as globals from '../../providers/globals/globals';\nimport {FlikeUser} from \"../../models/flikeUser.model\";\nimport {VariablesProvider} from \"../../providers/variables/variables\";\nimport {ChatServiceProvider} from \"../../providers/chat-service/chat-service\";\nimport {TranslationsProvider} from \"../../providers/translations/translations\";\nimport {ErrorLogProvider} from \"../../providers/error-log/error-log\";\n\n\n@IonicPage()\n@Component({\n    selector: 'page-group2',\n    templateUrl: 'group2.html',\n})\nexport class Group2Page {\n\n    user:FlikeUser;\n    chatRooms: Array<ChatRoom>;\n    globals: any = globals;\n    lastMessageTimestamp:number;\n\n\n    constructor(public navCtrl: NavController,\n                public navParams: NavParams,\n                public prefs: AppPreferences,\n                public db: AngularFireDatabase,\n                public loader: LoadingController,\n                public app: App,\n                public variables: VariablesProvider,\n                public chatService: ChatServiceProvider,\n                public translate: TranslationsProvider,\n                private errorHandler: ErrorLogProvider\n    ) {\n        this.chatRooms = [];\n        this.user = this.variables.user;\n        if (!this.user) this.navCtrl.setRoot(\"ActivationPage\")\n    }\n\n\n    ionViewWillEnter() {\n\n\n    }\n\n    ionViewDidLoad() {\n        this.getChatrooms();\n    }\n\n    getChatrooms(){\n        let loader = this.loader.create({\n            spinner: \"Bubbles\",\n            content:this.translate.getTranslation('loading')});\n        loader.present();\n        this.chatService.getChatroomByGroup(globals.group_2,this.user.id)\n            .subscribe( rooms => {\n                rooms.map( chatroom => {\n                    //we are updating last viewed message here because of the unexpected reloading\n                    //of chatrooms when data changed\n                    //this.chatService.updateMsgView(chatroom.id,this.user.id);\n                    let room: ChatRoom = {\n                        id: chatroom.payload.key,\n                        name : chatroom.payload.val().name,\n                        chatroomImgUrl : chatroom.payload.val().chatroomImgUrl,\n                        indicator : chatroom.payload.val().indicator,\n                        //lastMessage : {},\n                        userAccess : [],\n                        userMessageTimestamps : []\n                    }\n\n                    this.chatService.getChatroomData(chatroom.payload.key)\n                        .subscribe( thisroom => {\n\n                            //joinning all the info in an object for the array\n                            room.lastMessage = chatroom.payload.val().lastMessage\n                            //room.lastMessage = thisroom.lastMessage || {lastMessage:\"\"};\n                            for (let key in thisroom.payload.val().userAccess){\n                                //populate Array\n                                this.chatService.getUserInfoById(key)\n                                    .subscribe( actionUserInfo => {\n                                        let userInfo = actionUserInfo.payload.val()\n                                        userInfo.id = key;\n                                        if (!this.userExist(room.userAccess,userInfo.id)) {\n                                            room.userAccess.push(userInfo)\n                                        }\n                                    })\n                            }\n                            for (let key in thisroom.payload.val().userMessageTimestamps){\n                                //save lastMessageTimestamp. If we got a 0 value we don't overwrite it anymore to keep\n                                //track of message not read (0 is de default value for a non read message)\n                                if (key != this.user.id && this.lastMessageTimestamp != 0)\n                                    this.lastMessageTimestamp = thisroom.payload.val().userMessageTimestamps[key].viewTimestamp;\n                                //populate array\n                                let timestamp = {id:key,viewTimestamp:thisroom.payload.val().userMessageTimestamps[key].viewTimestamp}\n                                if (!this.userExist(room.userMessageTimestamps,timestamp.id)){\n                                    room.userMessageTimestamps.push(timestamp)\n                                }\n                            }\n                            this.pushOrUpdate(room)\n                        }, error => {\n                            this.errorHandler.sendError(\"group2, getChatRoomData - subscription\",error);\n                            this.prefs.remove(globals.userPrefs,globals.userItem);\n                            let nav = this.app.getRootNav();\n                            nav.setRoot(\"ActivationPage\")\n                            loader.dismiss();\n                        })\n                })\n                loader.dismiss()\n            }, error => {\n                this.errorHandler.sendError(\"group2, getChatroomByGroup - subscription\",error);\n                this.prefs.remove(globals.userPrefs,globals.userItem);\n                let nav = this.app.getRootNav();\n                nav.setRoot(\"ActivationPage\")\n                loader.dismiss();\n            })\n    }\n\n    pushOrUpdate(room:ChatRoom){\n        let indexOfRoom = -1;\n        for (let i = 0; i < this.chatRooms.length; i++){\n            if (room.id === this.chatRooms[i].id) indexOfRoom = i;\n        }\n        if (indexOfRoom != -1) this.chatRooms[indexOfRoom] = room;\n        else this.chatRooms.push(room)\n    }\n\n    goToChatroom(chatroom:ChatRoom){\n        let activeNavs = this.app.getRootNavs()\n        activeNavs[0].push(\"ChatPage\",{chatroom:chatroom})\n    }\n\n    userExist(array:any,userId){\n        let exist = false;\n        for (let i = 0; i < array.length; i++){\n            if (array[i].id === userId) exist = true;\n        }\n        return exist\n    }\n\n\n\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/group2/group2.ts"],"sourceRoot":""}